{% extends 'base.html.twig' %}

{% block title %} {{ parent() }}Modifier la sortie{% endblock %}

{% block body %}
    <h1>Modifier une sortie</h1>

    {% if sortie.organisateur is same as app.user %}

        {{ form_start(form) }}
        {{ form_widget(form) }}
        <div>
            <select id="lieu">

            </select>
            Adresse : {{ sortie.lieu.rue ~ ' à ' ~ sortie.lieu.ville.nom ~ ' - ' ~ sortie.lieu.ville.codePostal }}
        </div>
        <button type="submit">Valider les modifications</button>
        {{ form_end(form) }}

    {% else %}
        <p>Vous n'êtes pas organisateur de la sortie.</p>
    {% endif %}

    <a href="{{ path('app_main_connecte') }}">Retour la liste des sorties.</a>

    {% if sortie.organisateur is same as (app.user) %}

        <a href="{{ path('app_sortie_annulation', {'id':sortie.id}) }}">Annulation</a>
        <a href="{{ path('app_sortie_publier', {'id': sortie.id}) }}">Publier la sortie</a>
    {% endif %}

    <script>
        let windows;
        windows.onload = () => {
            const ville = document.querySelector("#sortie_modifier_ville");
            ville.addEventListener("change", () => {
                initListeLieux(ville.value);
            })

            function initListeLieux(ville) {
                fetch('{{ app.request.basePath }}/api/ville'+ville,
                    {
                        method: "POST",
                        headers: {'Accept': 'application/json'}
                    }
                ).then(response => response.json())
                    .then(response => {
                        let options = ""
                        response.map(lieu => {
                            options += <p> ${lieu.nom} </>
                        })
                        document.querySelector("#sortie_modifier_lieu").innerHTML = options
                    })
            }
        }
    </script>
{% endblock %}






